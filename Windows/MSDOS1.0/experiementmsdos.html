<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://yopokiq.github.io/Emulators/Windows/styles/font.css">
    <link id="favicon" rel="icon" href="https://iili.io/207HCAu.png" type="image/png">
    <title>MS-DOS 1.0 Emulator</title>
    <style>
        /* Make sure the canvas and body take up the full screen */
        html, body {
            margin: 0; 
            padding: 0;
            height: 100%;
            width: 100%;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="visibleContent"></canvas>
    <script>
        let files = [
            "COMMAND.COM",
            "MSDOS.SYS",
            "IO.SYS"
        ];

        function setFaviconBasedOnTheme() {
            const darkModeFavicon = "https://iili.io/207HCAu.png";
            const lightModeFavicon = "https://iili.io/205OIEP.png";
            const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const favicon = document.getElementById('favicon');
            if (isDarkMode) {
                favicon.href = darkModeFavicon;
            } else {
                favicon.href = lightModeFavicon;
            }
        }
        setFaviconBasedOnTheme();
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setFaviconBasedOnTheme);

        var canvas = document.getElementById("visibleContent");
        var context = canvas.getContext("2d");
        var getInput = "";
        const asciiArray = [];
        for (let i = 0; i < 128; i++) {
            asciiArray.push(String.fromCharCode(i));
        }

        // Array to hold input/output history
        let history = [];

        // Set canvas size on load
        function setCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            context.fillStyle = '#000000';
            context.fillRect(0, 0, canvas.width, canvas.height);
        }

        setCanvasSize(); // Initial size setting

        context.font = '20px "Fixedsys 62"';
        context.fillStyle = 'white';
        context.fillText("Microsoft Disk Operating System", 0, 13);
        context.fillText("Version 1.00", 0, 30);
        context.fillText("(C)Copyright Microsoft Corp 1981", -3, 50);

        // Draw the "A:>" prompt at the start
        function drawPrompt() {
            context.fillStyle = 'white';
            context.fillText("A:>", 0, 70); // Fixed position for "A:>"
        }

        // Draw everything (static content + prompt)
        function draw() {
            context.fillStyle = '#000000';  // Clear the screen
            context.fillRect(0, 0, canvas.width, canvas.height);

            // Redraw static text
            context.fillStyle = 'white';
            context.fillText("Microsoft Disk Operating System", 0, 13);
            context.fillText("Version 1.00", 0, 30);
            context.fillText("(C)Copyright Microsoft Corp 1981", -3, 50);

            // Always draw the "A:>" prompt
            let yOffset = 70;

            // Draw all previous inputs and outputs
            history.forEach(entry => {
                context.fillText(entry, 0, yOffset);
                yOffset += 30; // Increment line height
            });

            // Draw the current input after "A:>"
            if (getInput !== "") {
                context.fillText("A:> " + getInput, 0, yOffset);
            }
        }

        window.addEventListener("keydown", function(event) {
            if (event.key == "Backspace") {
                getInput = getInput.slice(0, getInput.length - 1); // Handle backspace
            } else if (asciiArray.includes(event.key)) {
                getInput += event.key.toUpperCase(); // Convert input to uppercase
            } else if (event.key == "Enter") {
                let output = "";
                if (getInput === "DIR") {
                    // Sort files in alphabetical order and join them with newline
                    output = files.sort().join("\n");
                } else if (getInput === "VER") {
                    // Print the version when "VER" is entered
                    output = "MS-DOS Version 1.00";
                } else {
                    // Display an error message for other commands
                    output = "Bad command or file name";
                }

                // Add input and output to history
                history.push("A:> " + getInput);
                history.push(output);

                // Reset input field after command execution
                getInput = "";

                // Redraw everything after input
                draw();
            }

            // Redraw everything after input
            draw();
        });

        window.addEventListener('resize', setCanvasSize); // Recalculate on resize

        // Initial draw call
        draw();
    </script>
</body>
</html>
